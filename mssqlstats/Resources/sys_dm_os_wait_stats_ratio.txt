SELECT /*mssqlstats_v1*/
  CAST(100.0 * SUM(CAST(signal_wait_time_ms AS numeric(38))) / SUM(CAST(wait_time_ms AS numeric(38))) AS numeric(20,2)) AS [%RUNNABLE]
  ,CAST(100.0 * SUM(CAST(wait_time_ms AS numeric(38)) - CAST(signal_wait_time_ms AS numeric(38))) / SUM(CAST(wait_time_ms AS numeric(38))) AS numeric(20,2)) AS [%RUNNING+SUSPEND]
FROM
  sys.dm_os_wait_stats
WHERE
  wait_time_ms > 0
  /*2017/01/29 update*/
  AND wait_type NOT IN (
    'BROKER_EVENTHANDLER'
    ,'BROKER_RECEIVE_WAITFOR'
    ,'BROKER_TASK_STOP'
    ,'BROKER_TO_FLUSH'
    ,'BROKER_TRANSMITTER'
    ,'CHECKPOINT_QUEUE'
    ,'CHKPT'
    ,'CLR_AUTO_EVENT'
    ,'CLR_MANUAL_EVENT'
    ,'CLR_SEMAPHORE'
    ,'DBMIRROR_DBM_EVENT'
    ,'DBMIRROR_EVENTS_QUEUE'
    ,'DBMIRROR_WORKER_QUEUE'
    ,'DBMIRRORING_CMD'
    ,'DIRTY_PAGE_POLL'
    ,'DISPATCHER_QUEUE_SEMAPHORE'
    ,'EXECSYNC'
    ,'FSAGENT'
    ,'FT_IFTS_SCHEDULER_IDLE_WAIT'
    ,'FT_IFTSHC_MUTEX'
    ,'HADR_CLUSAPI_CALL'
    ,'HADR_FILESTREAM_IOMGR_IOCOMPLETION'
    ,'HADR_LOGCAPTURE_WAIT'
    ,'HADR_NOTIFICATION_DEQUEUE'
    ,'HADR_TIMER_TASK'
    ,'HADR_WORK_QUEUE'
    ,'KSOURCE_WAKEUP'
    ,'LAZYWRITER_SLEEP'
    ,'LOGMGR_QUEUE'
    ,'MEMORY_ALLOCATION_EXT'
    ,'ONDEMAND_TASK_QUEUE'
    ,'PREEMPTIVE_OS_LIBRARYOPS'
    ,'PREEMPTIVE_OS_COMOPS'
    ,'PREEMPTIVE_OS_CRYPTOPS'
    ,'PREEMPTIVE_OS_PIPEOPS'
    ,'PREEMPTIVE_OS_AUTHENTICATIONOPS'
    ,'PREEMPTIVE_OS_GENERICOPS'
    ,'PREEMPTIVE_OS_VERIFYTRUST'
    ,'PREEMPTIVE_OS_FILEOPS'
    ,'PREEMPTIVE_OS_DEVICEOPS'
    ,'PWAIT_ALL_COMPONENTS_INITIALIZED'
    ,'QDS_PERSIST_TASK_MAIN_LOOP_SLEEP'
    ,'QDS_ASYNC_QUEUE'
    ,'QDS_CLEANUP_STALE_QUERIES_TASK_MAIN_LOOP_SLEEP'
    ,'REQUEST_FOR_DEADLOCK_SEARCH'
    ,'RESOURCE_QUEUE'
    ,'SERVER_IDLE_CHECK'
    ,'SLEEP_BPOOL_FLUSH'
    ,'SLEEP_DBSTARTUP'
    ,'SLEEP_DCOMSTARTUP'
    ,'SLEEP_MASTERDBREADY'
    ,'SLEEP_MASTERMDREADY'
    ,'SLEEP_MASTERUPGRADED'
    ,'SLEEP_MSDBSTARTUP'
    ,'SLEEP_SYSTEMTASK'
    ,'SLEEP_TASK'
    ,'SLEEP_TEMPDBSTARTUP'
    ,'SNI_HTTP_ACCEPT'
    ,'SP_SERVER_DIAGNOSTICS_SLEEP'
    ,'SQLTRACE_BUFFER_FLUSH'
    ,'SQLTRACE_INCREMENTAL_FLUSH_SLEEP'
    ,'SQLTRACE_WAIT_ENTRIES'
    ,'WAIT_FOR_RESULTS'
    ,'WAITFOR'
    ,'WAITFOR_TASKSHUTDOWN'
    ,'WAIT_XTP_HOST_WAIT'
    ,'WAIT_XTP_OFFLINE_CKPT_NEW_LOG'
    ,'WAIT_XTP_CKPT_CLOSE'
    ,'XE_DISPATCHER_JOIN'
    ,'XE_DISPATCHER_WAIT'
    ,'XE_LIVE_TARGET_TVF'
    ,'XE_TIMER_EVENT'
  ) -- omit the system-related wait stats
-- 必要に応じて実行の都度、統計をクリアを行う。
-- DBCC SQLPERF ('sys.dm_os_wait_stats', CLEAR)
OPTION(RECOMPILE)